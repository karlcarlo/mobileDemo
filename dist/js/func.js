/*! ux_tudian 2013-12-19 */
~function(t){t(function(){function o(){i(),_.on("mouseenter",".hotspot",function(){}).on("mouseleave",".hotspot",function(){}).on("click",'[data-action="hotspot_goto"]',function(t){t.preventDefault(),h(this)}).on("click",'[data-action="hotspot_back"]',function(t){t.preventDefault(),l(this)}).on("click",'[data-action="hotspot_cover"]',function(t){t.preventDefault(),Photonote.is_hotspot_visible&&n()}).on("mouseup","#photo_frame",function(o){t(o.target).closest(".hotspot").length||n()}),window.addEventListener("orientationchange",function(){a(),e()}),e()}function i(){m.length&&(m.forEach(function(t,o){var i={page_num:o,photos:[],first:!(1!=o+1),notfirst:!(1==o+1)},a="";i.photos.push(r(t)),a=Hogan.compile(v.album).render(i,v),_.append(a),g.push(c(t))}),_.find("#photo_frame").append(v.backcover),t("#"+c(f)).show())}function a(){}function e(){var t=_.find(".photo-wrapper").eq(0).width();Photonote.base_width=t,Photonote.critical=.3*t}function n(){Photonote.is_hotspot_visible&&d()}function d(){clearTimeout(Photonote.hotspot_timer)}function s(o){o.spot_width=photo_size[0]+8,o.spot_height=photo_size[1]+8;var i=t("#"+p(o.root_id));if(-1!==g.indexOf(o.dom_id)){var a=t("#"+o.dom_id);i.find("div.photo-wrapper").hide(),a.show().find("img.expanding").show(),a.find("img.hotspot:hidden").fadeIn()}else{var a,e=Hogan.compile(v.photospot).render(o,v);i.append(e),a=t("#"+o.dom_id),g.push(o.dom_id),i.find("div.photo-wrapper").hide(),a.show().find("img.hotspot:hidden").fadeIn()}}function r(t){t=t||f;var o={},i=u[t],a=i.records[0];return i&&(o=Object.create(i),o.dom_id=c(o.id),o.hotspot=[],o.total_page=m.length,o.current_page=m.indexOf(o.root_id||o.id)-0+1,a&&(o.records_top=a.pos_top,o.records_left=a.pos_left,o.records_voice=a.dataUrl,o.records_second=a.duration),i.hotspot.forEach(function(t){"object"==typeof u[t]&&o.hotspot.push({spot_id:u[t].id,top:u[t].top,left:u[t].left,src:u[t].src,cover:u[t].cover})})),o}function c(t){return"spot_"+t||f}function p(t){return"album_"+m.indexOf(t)}function h(o){var i=t(o),a=i.attr("data-spot-id");i.siblings("img.hotspot").fadeOut(),i.data("style_width")||i.data("style_width",i.css("width")),i.data("style_height")||i.data("style_height",i.css("height")),i.addClass("expanding").animate({width:photo_size[0],height:photo_size[1],"border-radius":0,"border-width":0,left:0,top:0},300,function(){s(r(a))})}function l(o){var i=t(o),a=i.attr("data-parent-id"),e=c(a),n=null,d=i.attr("data-type"),r=i.attr("data-id"),p=u[r];if("root"!==d){n=t("#"+e),s({dom_id:e,root_id:p.root_id});var h=n.find("img.expanding");h.removeClass("expanding").animate({width:h.data("style_width"),height:h.data("style_height"),left:p.left+"%",top:p.top+"%","border-radius":"50%","border-width":"0.2em"},300)}}Photonote={hotspot_timer:null,backspot_timer:null,touchstart_x:0,touchstart_y:0,wrapper_start_x:0,is_scroll_horizontal:!1,is_scroll_vertacal:!1,is_turning:!1,is_sliding:!1,is_hotspot_visible:!1,on_backcover:!1,is_prev:!1,is_next:!1,drap:!1,drop:!1,mouseover:!1,mouseout:!0,mousedown:!1,mouseup:!0,start_x:0,start_y:0,move_timer:0,is_moving:!1,base_width:0,critical:0,photo_size:[0,0],photo_border:0};var u=window.json.nodes,m=window.json.roots,_=(window.json.more,t("#photo_frame")),g=(t(".thumbnail"),[]),f="001",v={spot:['<img class="hotspot blink" data-action="hotspot_goto" data-spot-id="{{spot_id}}" src="http://s5.suc.itc.cn/ux_tudian/asset/mobile/nil.png" alt="" style="top:{{top}}%;left:{{left}}%;background-image:url({{src}});" />'].join(""),album:['<div id="album_{{page_num}}" class="album-wrapper data-aid="{{page_num}}" {{#first}}data-active="on"{{/first}} {{#notfirst}}data-active="no"{{/notfirst}} >',"   {{#photos}}","       {{>photo}}","   {{/photos}}","</div>"].join(""),photo:['<div class="photo-wrapper" id="{{dom_id}}">','    <div class="pos-abs btn-voice {{^records_top}}hide{{/records_top}}" data-id="{{id}}" style="top:{{records_top}}%; left:{{records_left}}%;">','        <a class="btn btnstop voice-hide" href="#"><i class="img-stop"></i>{{records_second}}"</a>','        <a class="btn btnplay" href="#"><i class="img-play"></i>{{records_second}}"</a>','        <audio controls="controls" id="audio_{{id}}">','        <source type="audio/mpeg" src="{{records_voice}}"></source>',"            Your browser does not support the audio element.","        </audio>","    </div>","    {{#hotspot}}","    {{>spot}}","    {{/hotspot}}",'    <div id="mod_{{id}}" data-action="hotspot_cover"  data-id="{{id}}" data-parent-id="{{parent_id}}" data-type="{{type}}" class="pos-abs img-mod picmod">','        <img data-info="backcover_zoom" src="{{cover}}" style="width:{{spot_width}}px; height:{{spot_height}}px; display: inline-block;"/>',"    </div>",'    <div class="picroot" id="picroot{{id}}" data-action="hotspot_back"  data-id="{{id}}" data-parent-id="{{parent_id}}" data-type="{{type}}">','        <img data-info="backcover_zoom" alt="" src="{{src}}" style="width:{{spot_width}}px; height:{{spot_height}}px; display: inline-block;" class="photo" draggable="false"/>',"    </div>","</div>"].join(""),photospot:['<div class="photo-wrapper" id="{{dom_id}}">','    <div data-action="hotspot_back"  data-id="{{id}}" data-parent-id="{{parent_id}}" data-type="{{type}}">','        <img alt="" src="{{src}}" style=" display: inline-block; width:{{spot_width}}px; height:{{spot_height}}px;" class="photo" draggable="false"/>',"    </div>","</div>"].join(""),backcover:['<div id="backcover" class="stamp second photo-wrapper">','  <div><img draggable="false" src="http://s5.suc.itc.cn/ux_tudian/asset/mobile/img_second_bg.jpg"></div>','  <div class="pos-rel png-box">','    <img draggable="false" class="second-bg" src="http://s5.suc.itc.cn/ux_tudian/asset/mobile/img_second_bg_p1.png">','    <div class="btn-wrapper"><a href="javascript:void(0);"><img draggable="false" class="img_second_bg" src="http://s5.suc.itc.cn/ux_tudian/src/asset/nil.png" alt=""></a></div>','    <img draggable="false" class="second-bg" src="http://s5.suc.itc.cn/ux_tudian/asset/mobile/img_second_bg_p2.png">',"  </div>","</div>"].join("")};o()})}(jQuery),jQuery(document).ready(function(t){function o(){s=window.innerHeight,r=window.innerWidth,u=s-28,m=Math.floor(320*u/480),d=(m+8)*window.json.roots.length,t("#photo_frame").css("width",d+"px"),t("#photo_box").css({width:m+8+"px",height:u+8+"px"}),t('div[data-type="root"] img.photo').height(u).show(),t('div[data-type="root"] img.photo').width(m).show(),t(".photo-wrapper .img-mod img").height(s-2*_).show(),t(".photo-wrapper .img-mod img").width(m).show(),t("#photo_frame").css({height:s+"px"})}function i(){1==y?t("div.arrow-group a").last().hide():t("div.arrow-group a").last().show(),v||t("div.arrow-group a").first().show()}function a(){return setTimeout(function(){t('div[data-action="hotspot_back"]').click()},500),b&&y==x?(t("html, body, .foot").animate({scrollTop:t(document).height()},500),t("div.arrow-group a").first().hide(),void 0):(b||(b=!0,x>y?(t("html, body, .foot").animate({scrollTop:0},300,function(){}),y+=1,t('.hotspot[data-action="hotspot_goto"]').fadeOut(),t("#photo_frame").animate({left:-(m+8)*(y-1)},w,function(){b=!1,t('.hotspot[data-action="hotspot_goto"]').fadeIn(500),i()})):y==x&&(t("html, body, .foot").animate({scrollTop:t(document).height()},500),t("div.arrow-group a").first().hide())),void 0)}function e(){setTimeout(function(){t('div[data-action="hotspot_back"]').click()},500),t("html, body, .foot").animate({scrollTop:0},300,function(){}),1!=y&&(y-=1,t('.hotspot[data-action="hotspot_goto"]').fadeOut(),t("#photo_frame").animate({left:-(m+8)*(y-1)},w,function(){b=!1,t('.hotspot[data-action="hotspot_goto"]').fadeIn(300),i()}))}function n(){window.location.href;var o=navigator.userAgent.toLowerCase(),i="ipad"==o.match(/ipad/i),a="iphone os"==o.match(/iphone os/i);"midp"==o.match(/midp/i),"rv:1.2.3.4"==o.match(/rv:1.2.3.4/i),"ucweb"==o.match(/ucweb/i);var e="android"==o.match(/android/i);"windows ce"==o.match(/windows ce/i),"windows mobile"==o.match(/windows mobile/i),e?(t("a.btn-download").attr("href","javascript:;"),t("a.btn-download").click(function(){alert("目前只支持苹果系统，安卓用户敬请期待！")})):(a||i)&&function(){window.location.href,setTimeout(function(){window.location=json.ios_jump},500)}()}var d,s,r,c,p,h,l,u,m,_=4;window.addEventListener("orientationchange",function(){setTimeout("onResize()",100)},!1),o();var g=t(".no-auto").width(),f=Math.floor(s/2-t(".arrow-group a").innerHeight()/2);t(".arrow-group").attr("style","width:"+g+"px;"),t(".arrow-group a").attr("style","top:"+f+"px; z-index:200; "),setTimeout(function(){var o=t("div.picroot img.photo")[0],i=t("div.picmod img")[0];c=o.height,p=o.width,h=i.height,l=i.width,t("div.picroot img.photo").width(m)},300),setTimeout(function(){var o=t("#picroot1 img");photo_size=[o.innerWidth(),o.innerHeight()],photo_border=_},500);var v=!1,w=400,b=!1,y=1,x=window.json.roots.length;t("div.arrow-group a i.icon-arrow-left").click(function(){e()}),t("div.arrow-group a i.icon-arrow-right").click(function(){a()}),t(".photo-wrapper").on("click",".img-mod",function(t){var o=t.clientX,i=window.innerWidth/2;o>i?a():e()}),i(),t("#share").click(function(){t(".modal").show()}),t(".modal").click(function(){t(".modal").hide()}),t(".btn-voice a.btnplay").click(function(){var o=t(this).parents(".btn-voice").attr("data-id");document.getElementById("audio_"+o).play(),console.dir(this),t(this).addClass("voice-hide").prev().removeClass("voice-hide")}),t(".btn-voice a.btnstop").click(function(){var o=t(this).parents(".btn-voice").attr("data-id");document.getElementById("audio_"+o).pause(),t(this).addClass("voice-hide").next().removeClass("voice-hide")}),n()});