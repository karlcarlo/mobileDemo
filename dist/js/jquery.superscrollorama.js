/*! ux_tudian 2013-12-19 */
(function(e){e.superscrollorama=function(t){function i(){d.scroll(function(){g=!0}),TweenLite.ticker.addEventListener("tick",s)}function n(e){var t={top:parseFloat(e.css("top")),left:parseFloat(e.css("left"))};return isNaN(t.top)&&(t.top=0),isNaN(t.left)&&(t.left=0),t}function s(){g&&(r(),g=!1)}function a(e){e.el.css("position",e.origPositioning.pos),e.el.css("top",e.origPositioning.top),e.el.css("left",e.origPositioning.left)}function o(e,t){e&&(e.totalProgress?e.totalProgress(t).pause():e.progress(t).pause())}function r(){var t,i,s,r=l.settings.isVertical?d.scrollTop()+m.y:d.scrollLeft()+m.x,h=l.settings.triggerAtCenter?l.settings.isVertical?-d.height()/2:-d.width()/2:0,u=p.length;for(t=0;u>t;t++){var g=p[t],_=g.target,b=g.offset;if("string"==typeof _?(c=e(_).offset()||{},i=l.settings.isVertical?c.top+m.y:c.left+m.x,b+=h):"number"==typeof _?i=_:e.isFunction(_)?i=_.call(this):(c=_.offset(),i=l.settings.isVertical?c.top+m.y:c.left+m.x,b+=h),i+=b,s=i+g.dur,r>i&&s>r&&"TWEENING"!==g.state&&(g.state="TWEENING",g.start=i,g.end=s),i>r&&"BEFORE"!==g.state&&g.reverse)l.settings.playoutAnimations||0===g.dur?g.tween.reverse():o(g.tween,0),g.state="BEFORE";else if(r>s&&"AFTER"!==g.state)l.settings.playoutAnimations||0===g.dur?g.tween.play():o(g.tween,1),g.state="AFTER";else if("TWEENING"===g.state){var v=!1;if(g.tween.repeat&&(v=-1===g.tween.repeat()),v){var y=g.tween.totalProgress();(null===g.playeadLastPosition||y===g.playeadLastPosition)&&(1===y?g.tween.yoyo()?g.tween.reverse():g.tween.totalProgress(0).play():g.tween.play()),g.playeadLastPosition=y}else o(g.tween,(r-g.start)/(g.end-g.start))}}var w=f.length;for(t=0;w>t;t++){var x=f[t],T=x.el;if("PINNED"!==x.state){var C=x.spacer.offset();"UPDATE"===x.state&&a(x),i=l.settings.isVertical?C.top+m.y:C.left+m.x,i+=x.offset,s=i+x.dur;var P=r>s&&"BEFORE"===x.state||i>r&&"AFTER"===x.state,k=r>i&&s>r;(k||P)&&(x.pushFollowers&&"static"===T.css("position")&&T.css("position","relative"),x.origPositioning={pos:T.css("position"),top:x.spacer.css("top"),left:x.spacer.css("left")},x.fixedPositioning={top:l.settings.isVertical?-x.offset:C.top,left:l.settings.isVertical?C.left:-x.offset},T.css("position","fixed"),T.css("top",x.fixedPositioning.top),T.css("left",x.fixedPositioning.left),x.pinStart=i,x.pinEnd=s,x.pushFollowers?l.settings.isVertical?x.spacer.height(x.dur+T.outerHeight()):x.spacer.width(x.dur+T.outerWidth()):"absolute"===x.origPositioning.pos?(x.spacer.width(0),x.spacer.height(0)):l.settings.isVertical?x.spacer.height(T.outerHeight()):x.spacer.width(T.outerWidth()),"UPDATE"===x.state?x.anim&&o(x.anim,0):x.onPin&&x.onPin("AFTER"===x.state),x.state="PINNED")}if("PINNED"===x.state)if(x.pinStart>r||r>x.pinEnd){var D=x.pinStart>r;x.state=D?"BEFORE":"AFTER",o(x.anim,D?0:1);var S=D?0:x.dur;l.settings.isVertical?x.spacer.height(x.pushFollowers?S:0):x.spacer.width(x.pushFollowers?S:0);var E=x.fixedPositioning.top-n(x.el).top,A=x.fixedPositioning.left-n(x.el).left;if(a(x),!x.pushFollowers||"absolute"===x.origPositioning.pos){var O;"relative"===x.origPositioning.pos?(O=l.settings.isVertical?parseFloat(x.origPositioning.top):parseFloat(x.origPositioning.left),isNaN(O)&&(O=0)):O=l.settings.isVertical?x.spacer.position().top:x.spacer.position().left;var j=l.settings.isVertical?"top":"left";x.el.css(j,O+S)}0!==E&&x.el.css("top",n(x.el).top-E),0!==A&&x.el.css("left",n(x.el).left-A),x.onUnpin&&x.onUnpin(!D)}else x.anim&&o(x.anim,(r-x.pinStart)/(x.pinEnd-x.pinStart))}}var l=this,h={isVertical:!0,triggerAtCenter:!0,playoutAnimations:!0,reverse:!0};l.settings=e.extend({},h,t);var c,u,d=e(window),p=[],f=[],m={x:0,y:0},g=!1;return l.addTween=function(e,t,i,n,s){return t.pause(),p.push({target:e,tween:t,offset:n||0,dur:i||0,reverse:s!==void 0?s:l.settings.reverse,state:"BEFORE"}),l},l.pin=function(t,i,n){"string"==typeof t&&(t=e(t));var s={offset:0,pushFollowers:!0};n=e.extend({},s,n),n.anim&&n.anim.pause();var a=e('<div class="superscrollorama-pin-spacer"></div>');return a.css("position","relative"),a.css("top",t.css("top")),a.css("left",t.css("left")),t.before(a),f.push({el:t,state:"BEFORE",dur:i,offset:n.offset,anim:n.anim,pushFollowers:n.pushFollowers,spacer:a,onPin:n.onPin,onUnpin:n.onUnpin}),l},l.updatePin=function(t,i,n){"string"==typeof t&&(t=e(t)),n.anim&&n.anim.pause();var s=f.length;for(u=0;s>u;u++){var a=f[u];t.get(0)===a.el.get(0)&&(i&&(a.dur=i),n.anim&&(a.anim=n.anim),n.offset&&(a.offset=n.offset),n.pushFollowers!==void 0&&(a.pushFollowers=n.pushFollowers),n.onPin&&(a.onPin=n.onPin),n.onUnpin&&(a.onUnpin=n.onUnpin),(i||n.anim||n.offset)&&"PINNED"===a.state&&(a.state="UPDATE",r()))}return l},l.removeTween=function(e,t,i){var n=p.length;i===void 0&&(i=!0);for(var s=0;n>s;s++){var a=p[s];a.target!==e||t&&a.tween!==t||(p.splice(s,1),i&&o(a.tween,0),n--,s--)}return l},l.removePin=function(t,i){"string"==typeof t&&(t=e(t)),i===void 0&&(i=!0);for(var n=f.length,s=0;n>s;s++){var r=f[s];r.el.is(t)&&(f.splice(s,1),i&&(r.spacer.remove(),a(r),r.anim&&o(r.anim,0)),n--,s--)}return l},l.setScrollContainerOffset=function(e,t){return m.x=e,m.y=t,l},l.triggerCheckAnim=function(e){return e?r():g=!0,l},i(),l}})(jQuery);