/*! ux_tudian 2013-11-15 */
(function(e){e.superscrollorama=function(t){function i(){d.scroll(function(){g=!0}),TweenLite.ticker.addEventListener("tick",s)}function n(e){var t={top:parseFloat(e.css("top")),left:parseFloat(e.css("left"))};return isNaN(t.top)&&(t.top=0),isNaN(t.left)&&(t.left=0),t}function s(){g&&(r(),g=!1)}function a(e){e.el.css("position",e.origPositioning.pos),e.el.css("top",e.origPositioning.top),e.el.css("left",e.origPositioning.left)}function o(e,t){e&&(e.totalProgress?e.totalProgress(t).pause():e.progress(t).pause())}function r(){var t,i,s,r=l.settings.isVertical?d.scrollTop()+m.y:d.scrollLeft()+m.x,h=l.settings.triggerAtCenter?l.settings.isVertical?-d.height()/2:-d.width()/2:0,c=p.length;for(t=0;c>t;t++){var g=p[t],_=g.target,b=g.offset;if("string"==typeof _?(u=e(_).offset()||{},i=l.settings.isVertical?u.top+m.y:u.left+m.x,b+=h):"number"==typeof _?i=_:e.isFunction(_)?i=_.call(this):(u=_.offset(),i=l.settings.isVertical?u.top+m.y:u.left+m.x,b+=h),i+=b,s=i+g.dur,r>i&&s>r&&"TWEENING"!==g.state&&(g.state="TWEENING",g.start=i,g.end=s),i>r&&"BEFORE"!==g.state&&g.reverse)l.settings.playoutAnimations||0===g.dur?g.tween.reverse():o(g.tween,0),g.state="BEFORE";else if(r>s&&"AFTER"!==g.state)l.settings.playoutAnimations||0===g.dur?g.tween.play():o(g.tween,1),g.state="AFTER";else if("TWEENING"===g.state){var v=!1;if(g.tween.repeat&&(v=-1===g.tween.repeat()),v){var y=g.tween.totalProgress();(null===g.playeadLastPosition||y===g.playeadLastPosition)&&(1===y?g.tween.yoyo()?g.tween.reverse():g.tween.totalProgress(0).play():g.tween.play()),g.playeadLastPosition=y}else o(g.tween,(r-g.start)/(g.end-g.start))}}var x=f.length;for(t=0;x>t;t++){var w=f[t],T=w.el;if("PINNED"!==w.state){var C=w.spacer.offset();"UPDATE"===w.state&&a(w),i=l.settings.isVertical?C.top+m.y:C.left+m.x,i+=w.offset,s=i+w.dur;var P=r>s&&"BEFORE"===w.state||i>r&&"AFTER"===w.state,k=r>i&&s>r;(k||P)&&(w.pushFollowers&&"static"===T.css("position")&&T.css("position","relative"),w.origPositioning={pos:T.css("position"),top:w.spacer.css("top"),left:w.spacer.css("left")},w.fixedPositioning={top:l.settings.isVertical?-w.offset:C.top,left:l.settings.isVertical?C.left:-w.offset},T.css("position","fixed"),T.css("top",w.fixedPositioning.top),T.css("left",w.fixedPositioning.left),w.pinStart=i,w.pinEnd=s,w.pushFollowers?l.settings.isVertical?w.spacer.height(w.dur+T.outerHeight()):w.spacer.width(w.dur+T.outerWidth()):"absolute"===w.origPositioning.pos?(w.spacer.width(0),w.spacer.height(0)):l.settings.isVertical?w.spacer.height(T.outerHeight()):w.spacer.width(T.outerWidth()),"UPDATE"===w.state?w.anim&&o(w.anim,0):w.onPin&&w.onPin("AFTER"===w.state),w.state="PINNED")}if("PINNED"===w.state)if(w.pinStart>r||r>w.pinEnd){var D=w.pinStart>r;w.state=D?"BEFORE":"AFTER",o(w.anim,D?0:1);var S=D?0:w.dur;l.settings.isVertical?w.spacer.height(w.pushFollowers?S:0):w.spacer.width(w.pushFollowers?S:0);var E=w.fixedPositioning.top-n(w.el).top,A=w.fixedPositioning.left-n(w.el).left;if(a(w),!w.pushFollowers||"absolute"===w.origPositioning.pos){var O;"relative"===w.origPositioning.pos?(O=l.settings.isVertical?parseFloat(w.origPositioning.top):parseFloat(w.origPositioning.left),isNaN(O)&&(O=0)):O=l.settings.isVertical?w.spacer.position().top:w.spacer.position().left;var j=l.settings.isVertical?"top":"left";w.el.css(j,O+S)}0!==E&&w.el.css("top",n(w.el).top-E),0!==A&&w.el.css("left",n(w.el).left-A),w.onUnpin&&w.onUnpin(!D)}else w.anim&&o(w.anim,(r-w.pinStart)/(w.pinEnd-w.pinStart))}}var l=this,h={isVertical:!0,triggerAtCenter:!0,playoutAnimations:!0,reverse:!0};l.settings=e.extend({},h,t);var u,c,d=e(window),p=[],f=[],m={x:0,y:0},g=!1;return l.addTween=function(e,t,i,n,s){return t.pause(),p.push({target:e,tween:t,offset:n||0,dur:i||0,reverse:s!==void 0?s:l.settings.reverse,state:"BEFORE"}),l},l.pin=function(t,i,n){"string"==typeof t&&(t=e(t));var s={offset:0,pushFollowers:!0};n=e.extend({},s,n),n.anim&&n.anim.pause();var a=e('<div class="superscrollorama-pin-spacer"></div>');return a.css("position","relative"),a.css("top",t.css("top")),a.css("left",t.css("left")),t.before(a),f.push({el:t,state:"BEFORE",dur:i,offset:n.offset,anim:n.anim,pushFollowers:n.pushFollowers,spacer:a,onPin:n.onPin,onUnpin:n.onUnpin}),l},l.updatePin=function(t,i,n){"string"==typeof t&&(t=e(t)),n.anim&&n.anim.pause();var s=f.length;for(c=0;s>c;c++){var a=f[c];t.get(0)===a.el.get(0)&&(i&&(a.dur=i),n.anim&&(a.anim=n.anim),n.offset&&(a.offset=n.offset),n.pushFollowers!==void 0&&(a.pushFollowers=n.pushFollowers),n.onPin&&(a.onPin=n.onPin),n.onUnpin&&(a.onUnpin=n.onUnpin),(i||n.anim||n.offset)&&"PINNED"===a.state&&(a.state="UPDATE",r()))}return l},l.removeTween=function(e,t,i){var n=p.length;i===void 0&&(i=!0);for(var s=0;n>s;s++){var a=p[s];a.target!==e||t&&a.tween!==t||(p.splice(s,1),i&&o(a.tween,0),n--,s--)}return l},l.removePin=function(t,i){"string"==typeof t&&(t=e(t)),i===void 0&&(i=!0);for(var n=f.length,s=0;n>s;s++){var r=f[s];r.el.is(t)&&(f.splice(s,1),i&&(r.spacer.remove(),a(r),r.anim&&o(r.anim,0)),n--,s--)}return l},l.setScrollContainerOffset=function(e,t){return m.x=e,m.y=t,l},l.triggerCheckAnim=function(e){return e?r():g=!0,l},i(),l}})(jQuery);