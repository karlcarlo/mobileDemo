/*! ux_tudian 2013-11-29 */
~function(e){e(function(){function t(){i(),b.on("mouseenter",".hotspot",function(){console.log("mouseenter"),a()}).on("mouseleave",".hotspot",function(){r()}).on("click",'[data-action="hotspot_goto"]',function(e){e.preventDefault(),p(this)}).on("click",'[data-action="hotspot_back"]',function(e){e.preventDefault(),f(this),Photonote.is_hotspot_visible||(a(),r())}).on("click",'[data-action="hotspot_cover"]',function(e){e.preventDefault(),Photonote.is_hotspot_visible?o():(a(),r())}).on("mouseup","#photo_frame",function(t){e(t.target).closest(".hotspot").length||o()}),window.addEventListener("orientationchange",function(){n(),s()}),s(),r()}function i(){if(g.length){g.forEach(function(e,t){var i={page_num:t,photos:[],last:!(t+1!=g.length)},n="";i.photos.push(c(e)),i.nodes=e.roots,n=Hogan.compile(x.album).render(i,x),b.append(n),y.push(u(e))});var t=[];_.forEach(function(e){var i={url:e};t.push(Hogan.compile(x.more).render(i))}),v.append(t.join("")),b.find("#photo_frame").append(x.backcover),e("#"+u(w)).show()}}function n(){}function s(){var e=b.find(".photo-wrapper").eq(0).width();Photonote.base_width=e,Photonote.critical=.3*e}function a(){clearTimeout(Photonote.hotspot_timer),b.find(".hotspot").show(),Photonote.is_hotspot_visible=!0}function o(){Photonote.is_hotspot_visible?l():(a(),r())}function r(){clearTimeout(Photonote.hotspot_timer),Photonote.hotspot_timer=setTimeout(function(){b.find(".hotspot").fadeOut("slow"),Photonote.is_hotspot_visible=!1},3e3)}function l(){clearTimeout(Photonote.hotspot_timer),b.find(".hotspot").hide(),Photonote.is_hotspot_visible=!1}function h(t){var i=e("#"+d(t.root_id));if(-1!==y.indexOf(t.dom_id)){var n=e("#"+t.dom_id);i.find("div.photo-wrapper").hide(),n.show().find("img.expanding").show(),n.find("img.hotspot:hidden").fadeIn()}else{var n,s=Hogan.compile(x.photo).render(t,x);i.append(s),n=e("#"+t.dom_id),y.push(t.dom_id),i.find("div.photo-wrapper").hide(),n.show().find("img.hotspot:hidden").fadeIn()}}function c(e){e=e||w;var t={},i=m[e],n=i.records[0];return i&&(t=Object.create(i),t.dom_id=u(t.id),t.hotspot=[],t.total_page=g.length,t.current_page=g.indexOf(t.root_id||t.id)-0+1,n&&(t.records_top=n.pos_top,t.records_left=n.pos_left,t.records_voice=n.dataUrl,t.records_second=n.duration),i.hotspot.forEach(function(e){"object"==typeof m[e]&&t.hotspot.push({spot_id:m[e].id,top:m[e].top,left:m[e].left,src:m[e].src,cover:m[e].cover})})),t}function u(e){return"spot_"+e||w}function d(e){return"album_"+g.indexOf(e)}function p(t){var i=e(t),n=i.attr("data-spot-id");i.siblings("img.hotspot").fadeOut(),i.data("style_width")||i.data("style_width",i.css("width")),i.data("style_height")||i.data("style_height",i.css("height")),i.addClass("expanding").animate({width:"100%",height:"100%","border-radius":0,"border-width":0,left:0,top:-(parseInt(e(".photo-wrapper").css("padding-bottom").slice(0,-2))/2)},function(){h(c(n))})}function f(t){var i=e(t),n=i.attr("data-parent-id"),s=u(n),a=null,o=i.attr("data-type"),r=i.attr("data-id"),l=m[r];if("root"!==o){a=e("#"+s),h({dom_id:s,root_id:l.root_id});var c=a.find("img.expanding");c.removeClass("expanding").animate({width:c.data("style_width"),height:c.data("style_height"),left:l.left+"%",top:l.top+"%","border-radius":"50%","border-width":"0.2em"})}}Photonote={hotspot_timer:null,touchstart_x:0,touchstart_y:0,wrapper_start_x:0,is_scroll_horizontal:!1,is_scroll_vertacal:!1,is_turning:!1,is_sliding:!1,is_hotspot_visible:!1,on_backcover:!1,is_prev:!1,is_next:!1,drap:!1,drop:!1,mouseover:!1,mouseout:!0,mousedown:!1,mouseup:!0,start_x:0,start_y:0,move_timer:0,is_moving:!1,base_width:0,critical:0};var m=window.json.nodes,g=window.json.roots,_=window.json.more,b=e("#photo_frame"),v=e(".thumbnail"),y=(b.find("#photo_frame"),[]),w="001",x={spot:['<img class="hotspot blink" data-action="hotspot_goto"   data-spot-id="{{spot_id}}" src="http://10.2.58.132/ux_tudian/src/asset/mobile/nil.png" alt="" style="top:{{top}}%;left:{{left}}%;background-image:url({{src}});">'].join(""),album:['<div id="album_{{page_num}}" class="album-wrapper {{#last}}last-bg{{/last}}">',"{{#photos}}","{{>photo}}","{{/photos}}","</div>"].join(""),photo:['<div id="{{dom_id}}" class="photo-wrapper">','<div class="pos-abs pagination"><span class="current">{{current_page}}</span>/<span class="total">{{total_page}}</span></div>',"{{#hotspot}}","{{>spot}}","{{/hotspot}}",'<div class="pos-abs btn-voice {{^records_top}}hide{{/records_top}}" data-id="{{id}}" style="top:{{records_top}}%; left:{{records_left}}%;">','  <a href="javascript:;" class="btn " style="display:none;"><i class="img-stop"></i>{{records_second}}"</a>','  <a href="javascript:;" class="btn "><i class="img-play"></i>{{records_second}}"</a>','  <audio controls="controls" id="audio_{{id}}">','    <source src="{{records_voice}}">',"     Your browser does not support the audio element.","  </audio>","</div>",'<div data-action="hotspot_cover"  data-id="{{id}}" data-parent-id="{{parent_id}}" data-type="{{type}}" class="pos-abs img-mod"><img src="{{cover}}" /></div>','<div data-action="hotspot_back" data-id="{{id}}" data-parent-id="{{parent_id}}" data-type="{{type}}"><img draggable="false" class="photo" src="{{src}}" alt=""></div>',"</div>"].join(""),backcover:['<div id="backcover" class="stamp second photo-wrapper">','  <div><img draggable="false" src="http://10.2.58.132/ux_tudian/src/asset/mobile/img_second_bg.jpg"></div>','  <div class="pos-rel png-box">','    <img draggable="false" class="second-bg" src="http://10.2.58.132/ux_tudian/src/asset/mobile/img_second_bg_p1.png">','    <div class="btn-wrapper"><a href="javascript:void(0);"><img draggable="false" class="img_second_bg" src="http://10.2.58.132/ux_tudian/src/asset/nil.png" alt=""></a></div>','    <img draggable="false" class="second-bg" src="http://10.2.58.132/ux_tudian/src/asset/mobile/img_second_bg_p2.png">',"  </div>","</div>"].join(""),more:['<a data-action="download" href="javascript:;">','<img src="{{url}}"/>',"</a>"].join("")};t()})}(jQuery),jQuery(document).ready(function(e){function t(){var t=window.location.href,i=navigator.userAgent.toLowerCase();"ipad"==i.match(/ipad/i);var n="iphone os"==i.match(/iphone os/i);"midp"==i.match(/midp/i),"rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),"ucweb"==i.match(/ucweb/i);var s="android"==i.match(/android/i);"windows ce"==i.match(/windows ce/i),"windows mobile"==i.match(/windows mobile/i),s?(e(".footerimg").hide(),e(".footerbox").hide()):n?(function(){window.location.href,setTimeout(function(){window.location=json.ios_jump},500)}(),e("#photo_frame > div#album_4").nextAll(".album-wrapper").remove(),/wx/.test(t)?(e(".ios_wx").show(),e(".ios_wb").hide()):/wb/.test(t)&&(e(".ios_wx").hide(),e(".ios_wb").show())):(console.log("this is pc note3"),e(".footerimg").hide(),e(".ios_wx").hide(),e(".ios_wb").hide())}e("#share").click(function(){e(".modal").show()}),e(".modal").click(function(){e(".modal").hide()}),e(".thumbnail").on("click",'[data-action="download"]',function(e){e.preventDefault(),window.confirm("下载由我图记，查看全部内容","no")&&(window.location.href="https://itunes.apple.com/cn/app/you-wo-tu-ji/id703248106?mt=8")}),e(".footer").on("click",'[data-action="create_album"]',function(e){e.preventDefault(),window.location.href="https://itunes.apple.com/cn/app/you-wo-tu-ji/id703248106?mt=8"}),e(".btn-voice a.btn i.img-play").click(function(){var t=e(this).parents(".btn-voice").attr("data-id");document.getElementById("audio_"+t).play(),e(this).parent().addClass("hide").prev().removeClass("hide")}),e(".btn-voice a.btn i.img-stop").click(function(){var t=e(this).parents(".btn-voice").attr("data-id");document.getElementById("audio_"+t).pause(),e(this).parent().addClass("hide").next().removeClass("hide")}),t()});