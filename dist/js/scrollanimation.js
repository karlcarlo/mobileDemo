/*! ux_tudian 2013-11-29 */
(function(e,t){var i=960,n=768,s=[],a={delay:2e3,dur:500,data:{pics:["http://s5.suc.itc.cn/ux_tudian/asset/desktop/img_scroll01.jpg","http://s5.suc.itc.cn/ux_tudian/asset/desktop/img_scroll02.jpg","http://s5.suc.itc.cn/ux_tudian/asset/desktop/img_scroll03.jpg"]},template:["<ul>","{{#pics}}",'<li><img src="{{.}}" alt="" /></li>',"{{/pics}}","</ul>"].join(""),init:function(e){this.$box=e,this.$curItem=null,this.tid=null,this.render()},render:function(){this.$ul&&this.$ul.stop(),this.$box.html(Hogan.compile(this.template).render(this.data)),this.$ul=this.$box.find("ul"),this.$ul.css({width:224*this.data.pics.length})},start:function(t){return this.tid&&clearInterval(this.tid),t&&this.render(),this.$curItem||(this.$curItem=this.$ul.find("li:first")),this.tid=setInterval(e.proxy(this.slide,this),this.delay+this.dur),this},stop:function(e){return clearInterval(this.tid),this.render(),this.$curItem=null,e>0&&this.$ul.find("li:lt("+e+")").hide(),this},slide:function(){this.$curItem.next().length||this.$ul.append(this.$ul.find("li:first")),this.$ul.css({left:-(224*this.$curItem.index())}).animate({left:"-=224"},this.dur,"swing"),this.$curItem=this.$curItem.next()}},o={delay:2500,dur:200,data:{pics:[{pic:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/img_ss05.png",bg:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/bg_ss05.jpg"},{pic:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/img_ss01.png",bg:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/bg_ss01.jpg"},{pic:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/img_ss02.png",bg:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/bg_ss02.jpg"},{pic:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/img_ss03.png",bg:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/bg_ss03.jpg"},{pic:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/img_ss04.png",bg:"http://s5.suc.itc.cn/ux_tudian/asset/desktop/bg_ss04.jpg"}]},template:["<ul>","{{#pics}}",'<li data-bg="{{bg}}"><img src="{{pic}}" alt="" /></li>',"{{/pics}}","</ul>"].join(""),init:function(e,t){this.$box=e,this.$bg=t,this.$curItem=null,this.tid=null,this.render()},render:function(){this.$ul&&this.$ul.stop(),this.$box.html(Hogan.compile(this.template).render(this.data)),this.$ul=this.$box.find("ul"),this.$ul.css({width:126*this.data.pics.length}),this.setCurItem(),this.setBg()},setCurItem:function(e){e=e||1,this.$curItem=this.$ul.find("li").eq(e),this.$ul.css({left:-(126*this.$curItem.index()-22)})},start:function(t){this.tid&&clearInterval(this.tid),t&&this.render(),this.show();var i=this.$ul.find("li"),n=this.$curItem.index(),s=this.$curItem.position(),a=[];i.each(function(){a.push(e(this).position())});var o=new TimelineLite({onComplete:function(){i.each(function(){e(this).css({position:"static",left:"auto",top:"auto"})})},paused:!0}),r=[];return i.each(function(t){var i=e(this);i.css({position:"absolute",left:a[t].left,top:a[t].top,zIndex:t==n?100:1}),r.push(TweenMax.from(i,.25,{css:{top:s.top,left:s.left}}))}),o.add(r),o.play(),this.tid=setInterval(e.proxy(this.slide,this),this.delay+this.dur),this},stop:function(){return clearInterval(this.tid),this.render(),this},slide:function(){var t=this;1==this.$curItem.prevAll().length&&this.$ul.prepend(this.$ul.find("li:last")),this.setCurItem(this.$curItem.index()),this.$ul.animate({left:"+=126"},this.dur,"swing",function(){setTimeout(e.proxy(t.setBg,t),500)}),this.$curItem=this.$curItem.prev()},setBg:function(){this.$bg.html('<img width="170" height="222" src="'+this.$curItem.attr("data-bg")+'" />').find("img").css("opacity",.4).animate({opacity:1},500)},hide:function(){return this.$ul.hide(),this.$bg.children().hide(),this},show:function(){return this.$ul.show(),this.$bg.children().show(),this},clone:function(){return this.$ul.clone()}},r={init:function(){e(t).scrollTop(0),this.$elems={canvas:e("#canvas"),part1:e("#part1"),part2:e("#part2"),part3:e("#part3"),part4:e("#part4")},a.init(this.$elems.part1.find("div.pic-scroll")),a.start(),o.init(this.$elems.part4.find("div.img-scroll"),this.$elems.part4.find("div.bg")),this.backTop(),this.containerAutoSize(),this.controller=e.superscrollorama(),this.addTweens(),this.scrollToLinks(),e(t).resize(e.proxy(this.resize,this))},backTop:function(){var i=this;e('<a href="#" id="back_top"></a>').click(function(t){t.preventDefault(),e.scrollTo(i.$elems.part1,1e3)}).appendTo("body").hide(),e(t).scroll(function(){e("#back_top")[e(this).scrollTop()>0?"fadeIn":"fadeOut"]()})},scrollToLinks:function(){e("a.link-one").click(function(t){t.preventDefault(),e.scrollTo("#part2",1e3)}),e("a.link-two").click(function(t){t.preventDefault(),e.scrollTo("#part3",1e3)}),e("a.link-three").click(function(t){t.preventDefault(),e.scrollTo("#part4",1e3)}),e("a.link-four").click(function(t){t.preventDefault(),e.scrollTo("#part1",1e3)})},containerAutoSize:function(){var s=e(t).width(),a=e(t).height();i>s?(this.$elems.part1.width(i),this.$elems.part2.width(i),this.$elems.part3.width(i),this.$elems.part4.width(i)):(this.$elems.part1.css("width","auto"),this.$elems.part2.css("width","auto"),this.$elems.part3.css("width","auto"),this.$elems.part4.css("width","auto")),a>n?(this.$elems.part1.height(a),this.$elems.part2.height(a),this.$elems.part3.height(a),this.$elems.part4.height(a)):(this.$elems.part1.css("height","auto"),this.$elems.part2.css("height","auto"),this.$elems.part3.css("height","auto"),this.$elems.part4.css("height","auto"))},addTweens:function(){e('<img id="mov1" class="pop" src="http://s5.suc.itc.cn/ux_tudian/asset/desktop/img_parttwo.jpg" alt="" />').appendTo(this.$elems.canvas).hide(),e('<img id="mov2" class="pop" src="http://s5.suc.itc.cn/ux_tudian/asset/desktop/book.png" alt="" />').appendTo(this.$elems.canvas).hide();var t=e("#mov1"),i=e("#mov2"),n=this.$elems.part3.find(".book img"),r=5,l=this.$elems.part2.offset(),h=this.$elems.part3.offset(),u=this.$elems.part4.offset();n.eq(0).show().end().eq(1).hide();var c=107,d=this.$elems.part1.find("div.pic-scroll").offset(),p=this.$elems.part2.find("div.parttwo-con > div.img").offset(),f=l.top-c-r;t.css({left:d.left,top:d.top,width:224,height:324,zIndex:100}),s.push(c),this.controller.addTween(c,TweenMax.to(t,2,{css:{left:p.left,top:p.top,width:322,height:480,zIndex:1},onStart:function(){t.show(),a.stop(1)},onReverseComplete:function(){t.hide(),a.start(!0)}}),f);var m=l.top+180,g=this.$elems.part3.find("div.book").offset(),_=h.top-m-r;s.push(m),this.controller.addTween(m,TweenMax.to(t,2,{css:{left:g.left,top:g.top,width:341,height:443,zIndex:100,opacity:.6},onUpdate:function(){var e=t.offset();e.left!=g.left||e.top!=g.top?(t.show(),n.eq(0).show(),n.eq(1).hide()):(t.fadeOut("fast"),n.eq(0).hide(),n.eq(1).fadeIn("fast"))}}),_),i.css({left:g.left,top:g.top,width:341,height:443,zIndex:100});var b=h.top+180,v=this.$elems.part4.find("div.img-scroll").offset(),y=u.top-b-r;s.push(b),v.left+=37,v.top+=251,this.controller.addTween(b,TweenMax.to(i,2,{css:{left:v.left,top:v.top,width:95,height:123,zIndex:100},onComplete:function(){i.hide(),o.start(!0)},onReverseComplete:function(){i.hide(),n.eq(0).hide(),n.eq(1).show()},onUpdate:function(){var e=i.offset();e.left!=v.left||e.top!=v.top?(i.show(),n.hide(),o.stop().hide()):(i.hide(),o.start(!0))}}),y)},removeTweens:function(){for(var t=0;s.length>t;t+=1)this.controller.removeTween(s[t]);s=[],e("#mov1").remove(),e("#mov2").remove()},resize:function(){this.containerAutoSize(),this.removeTweens(),e(t).scrollTop(0),this.addTweens()}};e(function(){r.init()})})(jQuery,window);